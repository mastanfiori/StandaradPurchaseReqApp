/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["ui/ssuite/s2p/mm/pur/pr/prcss/s1/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","ui/ssuite/s2p/mm/pur/pr/prcss/s1/model/formatter","ui/ssuite/s2p/mm/pur/pr/prcss/s1/controller/ServiceManager","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox","sap/m/MessageStrip"],function(B,J,H,f,S,F,a,M){"use strict";var m=new sap.m.MessagePopoverItem({type:"{state}",title:"{name}",counter:"{aMessages.length}"});var o=new sap.m.MessagePopover("idPopover",{items:{path:'/',template:m}});return B.extend("ui.ssuite.s2p.mm.pur.pr.prcss.s1.controller.ContractPreview",{formatter:f,ServiceManager:S,onInit:function(){this.sDate=0;this.eDate=0;this.getRouter().getRoute("ContractPreview").attachPatternMatched(jQuery.proxy(function(e){var n=e.getParameter("name");this.oApplicationModel=this.getModel();if(n==="ContractPreview"){var r=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter=r;this.byId('idCtrSubmit').setEnabled(true);this.getView().byId("idMessageStrip").setVisible(false);this.is_initial_load=true;this.sDate=0;this.eDate=0;if(this.is_initial_load===true){this.byId('idCtrTabContainer').getBinding("items").refresh();}this.refreshContractDrafts();o.destroyItems();this.byId('idBCtrMsgPopover').setText('');this.negativeQuantity=false;}}),this);if(!jQuery.support.touch){this.getView().addStyleClass("sapUiSizeCompact");}},onAfterRendering:function(){this.byId('ContractsPreview').setShowHeader(false);},comboFill:function(c){c.getSource().getBinding("items").resume();},refreshContractDrafts:function(d,r){var b=this.oApplicationModel;var p={urlParameters:{"$expand":"to_PurContrItmDrftForMngPurReqn"},success:jQuery.proxy(this.onSuccessCtrDraftRead,this),error:jQuery.proxy(this.onErrorRequest,this)};b.read("/C_PurContrDrftForMngPurReqn",p);this.byId('idCtrSubmit').setEnabled(true);if(r!==undefined){if(r.headers['sap-message']!==undefined){this.checkFieldsCTRPreview();this.getView().rerender();I=this.byId('idCtrTabContainer').getSelectedItem();var s=I.replace('idTabCtrContainerItem','idBCtrMsgPopover');var c=this.byId(s);c.setVisible(true);var e;e=JSON.parse(r.headers['sap-message']).details;var g=new Array();var C=new Array();if(e!==undefined){if(e.length>0){for(var i=0;i<e.length;i++){C={name:JSON.parse(r.headers['sap-message']).details[i].message,state:this._getMessageState(JSON.parse(r.headers['sap-message']).details[i].severity),icon:this._getMessageIcon(JSON.parse(r.headers['sap-message']).details[i].severity)};g.push(C);}if(JSON.parse(r.headers['sap-message']).code!=='APPL_MM_PR/004'){C={name:JSON.parse(r.headers['sap-message']).message,state:this._getMessageState(JSON.parse(r.headers['sap-message']).severity),icon:this._getMessageIcon(JSON.parse(r.headers['sap-message']).severity)};g.push(C);}}else if((JSON.parse(r.headers['sap-message']).code!=='APPL_MM_PR/004')&&(JSON.parse(r.headers['sap-message']).message!=='')){C={name:JSON.parse(r.headers['sap-message']).message,state:this._getMessageState(JSON.parse(r.headers['sap-message']).severity),icon:this._getMessageIcon(JSON.parse(r.headers['sap-message']).severity)};g.push(C);}else{this._getMessagePopover(g).close();var I=this.byId('idCtrTabContainer').getSelectedItem();var h=I.replace('idTabCtrContainerItem','idMessageStrip');var j=this.byId(h);j.setVisible(false);}o=this._getMessagePopover(g);}}}},onErrorUpdate:function(){},onSuccessCtrTypeRead:function(d,r){this.oCTRTypes=d.results;},onErrorRequest:function(e){},onSuccessCtrDraftRead:function(r,d){var c=d.data;if(!this.oldData){this.oldData=d.data;}if(c){var C=c;if(C.results.length===0){this.onNavBack();}if(this.oldData.results.length!==C.results.length){this.oldData=d.data;if(this.is_initial_load===false){this.byId('idCtrTabContainer').getBinding("items").refresh();}}if(c.results.length===1){this.byId('idCtrTabContainer').getAggregation('_tabStrip').setProperty('visible',false);}else if(c.results.length>1){this.byId('idCtrTabContainer').getAggregation('_tabStrip').setProperty('visible',true);}}else if(!c){if(c.results.length===0){this.onNavBack();}}this.is_initial_load=false;},checkFieldsCTRPreview:function(){var i=this.byId('idCtrTabContainer').getSelectedItem();var c=i.replace('idTabCtrContainerItem','idCtrTypes');var C=this.byId(c);if(C.getValue('value')===''){C.setValueState(sap.ui.core.ValueState.Error);C.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errCtrType"));}var t=i.replace('idTabCtrContainerItem','idCtrTargetVal');var b=this.byId(t);if((C.getValue('value').indexOf('CWK')>0||C.getValue('value').indexOf('WK')>0)&&(b.getValue('value')==="0.00"||b.getValue('value')==="")){b.setValueState(sap.ui.core.ValueState.Error);}var s=i.replace('idTabCtrContainerItem','idSupplier');var d=this.byId(s);if(d.getValue('value')===''){d.setValueState(sap.ui.core.ValueState.Error);d.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errSupplier"));}var p=i.replace('idTabCtrContainerItem','idPurchasingGroup');var P=this.byId(p);if(P.getValue('value')===''){P.setValueState(sap.ui.core.ValueState.Error);P.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errPGrp"));}var e=i.replace('idTabCtrContainerItem','idPurchasingOrg');var g=this.byId(e);if(g.getValue('value')===''){g.setValueState(sap.ui.core.ValueState.Error);g.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errPOrg"));}},tabitemSelect:function(e){o.destroyItems();var i=this.byId('idCtrTabContainer').getSelectedItem();if(i!=null||i!=undefined){var s=i.replace('idTabCtrContainerItem','idBCtrMsgPopover');var b=this.byId(s);b.setVisible(false);}this.negativeQuantity=false;},handleDelete:function(e){var s=e.getParameter('listItem').getBindingContext();var d=e.getSource().getModel().getProperty('PurchaseContractItemDraftUUID',s);var D="/C_PurContrItmDrftForMngPurReqn(PurchaseContractItemDraftUUID=guid'"+d+"')";var b=this.oApplicationModel;b.remove(D,{success:jQuery.proxy(this.refreshContractDrafts,this)});},updateCtrDraft:function(p,s){var b=this.oApplicationModel;b.setRefreshAfterChange(false);var c="/C_PurContrDrftForMngPurReqn(guid'"+s+"')";var P=new Object();P.success=jQuery.proxy(this.refreshContractDrafts,this);P.error=jQuery.proxy(this.onErrorUpdate,this);b.update(c,p,P);},onChangeCtrType:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var c=this.getView().getModel().getProperty('PurchasingDocumentType',s);var C=this.changeValueState(e.getSource(),c);this.onChangePayload(e,v);},onChangeStartDate:function(e){var s=e.getSource().getBindingContext();var d=e.getSource().getDateValue();this.sDate=d;var v=this.getView().getModel().getProperty('ValidityEndDate',s);var b=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var c=new Date();var g=new Date(d);var E;if(this.eDate==="0"){this.eDate=v;}if(c>d){e.getSource().setValueState("Error");E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errDateInPast");e.getSource().setValueStateText(E);}else if(d>this.eDate){e.getSource().setValueState("Error");E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity");e.getSource().setValueStateText(E);}else{if(this.getTestMode()===undefined||this.getTestMode()===false){e.getSource().setValueState("None");var h="ValStartDate";this.onChangePayload(e,b,h);}}},onChangeEndDate:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var V=e.getSource().getDateValue();this.eDate=V;var d=this.getView().getModel().getProperty('ValidityStartDate',s);var c=new Date();var E=new Date(V);var b;if(this.sDate==="0"){this.sDate=d;}if(c>V){e.getSource().setValueState("Error");b=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errEndInPast");e.getSource().setValueStateText(b);}else if(this.sDate>V){e.getSource().setValueState("Error");b=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity");e.getSource().setValueStateText(b);}else{if(this.getTestMode()===undefined||this.getTestMode()===false){e.getSource().setValueState("None");var g="ValEndDate";this.onChangePayload(e,v,g);}}},onChangeTargetValue:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var t=this.getView().getModel().getProperty('PurchaseContractTargetAmount',s);this.changeValueState(e.getSource(),t);var n=t.split(".");var i=this.byId('idCtrTabContainer').getSelectedItem();var T=i.replace('idTabCtrContainerItem','idCtrTargetVal');var c=this.byId(T);var b=i.replace('idTabCtrContainerItem','idCtrSubmit');var d=this.byId(b);if(n[0].length>13){c.setValueState(sap.ui.core.ValueState.Error);c.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidTrgtVal"));d.setEnabled(false);}else{d.setEnabled(true);}if(n[1]!==undefined){if(n[1].length>3){c.setValueState(sap.ui.core.ValueState.Error);c.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidTrgtVal"));}}if(c.getValueState()!=="Error"){var N=t.indexOf("-");if(N<0){if(this.getTestMode()===undefined||this.getTestMode()===false){this.onChangePayload(e,v);}}else{c.setValueState(sap.ui.core.ValueState.Error);c.setValueStateText(this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidTrgtVal"));}}if(t===''||t===undefined){if(c.getValue('value')===''||c.getValue('value')===undefined){c.setValue('0.00');c.setValueState(sap.ui.core.ValueState.None);}if(this.getTestMode()===undefined||this.getTestMode()===false){this.onChangePayload(e,v);}}},onChangePurchasingGroup:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var p;var c=this.changeValueState(e.getSource(),p);var b="PGrp";if(this.PGrpFromF4){p=this.PGrpFromF4;e.getSource().setValue(p);}else{p=e.getParameter("value");}if(this.getTestMode()===undefined||this.getTestMode()===false){this.onChangePayload(e,v,b,p);}},onChangePurchasingOrganization:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var p;var c=this.changeValueState(e.getSource(),p);var b="POrg";if(this.POrgFromF4){p=this.POrgFromF4;e.getSource().setValue(p);}else{p=e.getParameter("value");}if(this.getTestMode()===undefined||this.getTestMode()===false){this.onChangePayload(e,v,b,p);}},onChangePayload:function(e,s,v,p){var b=e.getSource().getBindingContext();var c=this.getView().getModel().getProperty('PurchasingDocumentType',b);var t=this.getView().getModel().getProperty('PurchaseContractTargetAmount',b);if(t===''||t===undefined){t="0.00";}var d=this.getView().getModel().getProperty('Supplier',b);if(this.sDate===0){this.sDate=this.getView().getModel().getProperty('ValidityStartDate',b);}if(this.eDate===0){this.eDate=this.getView().getModel().getProperty('ValidityEndDate',b);}var g=this.sDate;var h=new Date(g);var V=this.eDate;var E=new Date(V);var P,i;var D=this.getView().getModel().getProperty('SerialNumber',b);this.vDraftSlNoForFieldEnable=D;i=this.getView().getModel().getProperty('PurchasingGroup',b);P=this.getView().getModel().getProperty('PurchasingOrganization',b);if(v==="POrg"){this.bPOrgEditable=D+"true";P=p;i=this.getView().getModel().getProperty('PurchasingGroup',b);this.changeValueState(e.getSource(),P);}else if(v==="PGrp"){this.bPGrpEditable=D+"true";i=p;P=this.getView().getModel().getProperty('PurchasingOrganization',b);this.changeValueState(e.getSource(),i);}h.setDate(g.getDate()+1);E.setDate(V.getDate()+1);if(t===""){t="0";}var j={'PurchaseContractDraftUUID':s,'PurchasingDocumentType':c,'Supplier':d,'ValidityStartDate':h,'ValidityEndDate':E,'PurchaseContractTargetAmount':t,'PurchasingGroup':i,'PurchasingOrganization':P};this.updateCtrDraft(j,s);},onChangeTargetQty:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractItemDraftUUID',s);var t=this.getView().getModel().getProperty('TargetQuantity',s);if(t===""){t="0";}var c=this.changeValueState(e.getSource(),t);var E;this.negativeQuantity=false;var n=t.indexOf("-");var b=t.split(".");var p={'PurchaseContractItemDraftUUID':v,'TargetQuantity':t};var C="/C_PurContrItmDrftForMngPurReqn(PurchaseContractItemDraftUUID=guid'"+v+"')";var d=this.oApplicationModel;if((b[0].length<=10)&&(n<0)){if(((b[1]!==undefined)&&(b[1].length<=3))||(b[1]===undefined)){d.update(C,p,{success:jQuery.proxy(this.refreshContractDrafts,this),error:jQuery.proxy(this.onErrorUpdate,this)});}else{e.getSource().setValueState("Error");E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errTrgtQty");e.getSource().setValueStateText(E);}this.negativeQuantity=false;}else{e.getSource().setValueState("Error");E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errTrgtQty");e.getSource().setValueStateText(E);this.negativeQuantity=true;}},onChangeSupplier:function(e){var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var b=this.getView().getModel().getProperty('Supplier',s);var c=this.changeValueState(e.getSource(),b);if(this.getTestMode()===undefined||this.getTestMode()===false){this.onChangePayload(e,v);}},changeValueState:function(c,v){if(v){c.setValueState("None");return"X";}else{c.setValueState("Error");return;}},tabitemCloseHandler:function(e){e.preventDefault();var b=e.getParameter('item').getBindingContext();var i=e.getParameter('item');var c=e.getSource().getModel().getProperty('PurchaseContractDraftUUID',b);var t=this;var d=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText('CtrTabItemClose');sap.m.MessageBox.confirm(d+" "+i.getName()+"?",{onClose:function(A){if(A===sap.m.MessageBox.Action.OK){var g="/C_PurContrDrftForMngPurReqn(PurchaseContractDraftUUID=guid'"+c+"')";var h=t.oApplicationModel;t.byId('idCtrTabContainer').getBinding("items").refresh();var p={};p.success=jQuery.proxy(t.successDraftDelete,t);p.error=jQuery.proxy(t.fnErrorCtrHeaderDiscard,t);h.remove(g,p);}}});},fnContractDiscard:function(e){var c;this.vContractDraftUUID=e.getSource().getBindingContext().getProperty('PurchaseContractDraftUUID');if(this.getTestMode()===true){c=1;}else{c=parseInt(e.getSource().getParent().getId().charAt(e.getSource().getParent().getId().length-1))+1;}var C=parseInt(e.getSource().getParent().getId().charAt(e.getSource().getParent().getId().length-1))+1;if(!this._oPopover){this._oPopover=sap.ui.xmlfragment("ui.ssuite.s2p.mm.pur.pr.prcss.s1.fragment.discardCtr",this);this.getView().addDependent(this._oPopover);}var b=e.getSource();jQuery.sap.delayedCall(0,this,function(){this._oPopover.openBy(b);});var d=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText('DiscardCtrDraftmsg');sap.ui.getCore().byId("discardCtrtext").setText(d+C+"?");},handleCtrDiscardPress:function(e){var c=this.vContractDraftUUID.trim();var d="/C_PurContrDrftForMngPurReqn(PurchaseContractDraftUUID=guid'"+c+"')";var b=this.oApplicationModel;var p={};p.success=jQuery.proxy(this.successDraftDelete,this);p.error=jQuery.proxy(this.fnErrorCtrHeaderDiscard,this);b.remove(d,p);if(this.getTestMode()===true){window.history.go(-1);return;}},successDraftDelete:function(){if(this._oPopover){this._oPopover.close();var b=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText('DiscardDiscardSuccess');sap.m.MessageToast.show(b);}this.refreshContractDrafts();this.byId('idCtrTabContainer').getBinding("items").refresh();},fnErrorCtrHeaderDiscard:function(d,r){this._oPopover.close();var b=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText('DiscardDiscardFailure');sap.m.MessageToast.show(b,{duration:3000});},onExit:function(){if(this._oPopover){this._oPopover.destroy(true);}},onNavBack:function(e){this.byId('idCtrSubmit').setEnabled(false);this.oRouter.navTo("worklist");},handleContractSubmit:function(e){var b=[];this.byId('idCtrSubmit').setEnabled(false);var d=this.oApplicationModel;var s=e.getSource().getBindingContext();var v=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var p=this.getView().getModel().getProperty('PurchaseContract',s);this.PurCtr=p.replace(/^\D+/g,'');var c=v;var g='CT';var h={};var i=this;var j=this.sDate;var V=this.eDate;var C=new Date();var E;var k=new Array();if(j){if(j>V){var I=this.byId('idCtrTabContainer').getSelectedItem();var l=I.replace('idTabCtrContainerItem','idMessageStrip');var n=this.byId(l);n.setVisible(true);E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity");this.byId('idCtrSubmit').setEnabled(true);var I=this.byId('idCtrTabContainer').getSelectedItem();var q=I.replace('idTabCtrContainerItem','idBCtrMsgPopover');var r=this.byId(q);r.setVisible(true);var t={name:E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity"),state:this._getMessageState("error"),icon:this._getMessageIcon("error"),};k.push(t);o=this._getMessagePopover(k);this.getView().rerender();r.fireEvent("press");return;}}if(V){if(j>V){var I=this.byId('idCtrTabContainer').getSelectedItem();var l=I.replace('idTabCtrContainerItem','idMessageStrip');var n=this.byId(l);n.setVisible(true);E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity");this.byId('idCtrSubmit').setEnabled(true);var I=this.byId('idCtrTabContainer').getSelectedItem();var q=I.replace('idTabCtrContainerItem','idBCtrMsgPopover');var r=this.byId(q);r.setVisible(true);var t={name:E=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("errValidity"),state:this._getMessageState("error"),icon:this._getMessageIcon("error"),};k.push(t);o=this._getMessagePopover(k);this.getView().rerender();r.fireEvent("press");return;}}if(this.getTestMode()===undefined||this.getTestMode()===false){if(this.negativeQuantity!=true){S.activateBO(c,g,h,i);}}else{this.activateBoSuccess();}this.getView().rerender();},activateBoSuccess:function(d,r){if(this.getTestMode()==true){var s="Contract xxxxxxxx created";sap.m.MessageBox.success(s,{styleClass:"sapUiSizeCompact",actions:[this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("OK")],onClose:function(G){},initialFocus:this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("OK")});return;}var c=r.headers['sap-message'];var p=JSON.parse(r.headers['sap-message']).code;var n=0;var N=true;var b=new Array();var C=new Array();var v;this.vNumberOfContracts=this.byId('idCtrTabContainer').getItems().length;var t=this;var e=false;if(p=="ContractId/101"){var g=JSON.parse(r.headers['sap-message']).message;var h=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("Contract");var i=this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("createdSuccessfully");var j=" ";var k=h+j+g+j+i;sap.m.MessageBox.success(k,{styleClass:"sapUiSizeCompact",actions:[t.getOwnerComponent().getModel('i18n').getResourceBundle().getText("OK")],onClose:function(G){if(G===t.getOwnerComponent().getModel('i18n').getResourceBundle().getText("OK")){if(t.vNumberOfContracts>1){t.byId('idCtrTabContainer').getBinding("items").refresh();}t.refreshContractDrafts();}},initialFocus:this.getOwnerComponent().getModel('i18n').getResourceBundle().getText("OK")});e=true;}else{if(p=="FailedDraftId/101"){v=JSON.parse(r.headers['sap-message']).message;}else{v=JSON.parse(r.headers['sap-message']).details[0].message;}n=JSON.parse(r.headers['sap-message']).details;for(var l=0;l<n.length;l++){var q=JSON.parse(r.headers['sap-message']).details[l].code;if(q=="FailedDraftId/101"){continue;}C={name:JSON.parse(r.headers['sap-message']).details[l].message,state:this._getMessageState(JSON.parse(r.headers['sap-message']).details[l].severity),icon:this._getMessageIcon(JSON.parse(r.headers['sap-message']).details[l].severity)};b.push(C);}if(JSON.parse(r.headers['sap-message']).code!="FailedDraftId/101"){C={name:JSON.parse(r.headers['sap-message']).message,state:this._getMessageState(JSON.parse(r.headers['sap-message']).severity),icon:this._getMessageIcon(JSON.parse(r.headers['sap-message']).severity)};b.push(C);}var u=v.slice(0,8);var w=v.slice(8,12);var T=v.slice(12,16);var x=v.slice(16,20);var L=v.slice(20,32);var D="-";this.vFailedGuid="guid'"+u+D+w+D+T+D+x+D+L+"'";this.vActivePurchaseContract="%2523%2520%2520%2520%2520%2520%2520%2520"+this.PurCtr;this.checkFieldsCTRPreview();var I=this.byId('idCtrTabContainer').getSelectedItem();var y=I.replace('idTabCtrContainerItem','idMessageStrip');var z=this.byId(y);z.setVisible(true);this.byId('idCtrSubmit').setEnabled(true);var I=this.byId('idCtrTabContainer').getSelectedItem();var A=I.replace('idTabCtrContainerItem','idBCtrMsgPopover');var E=this.byId(A);E.setVisible(true);o=this._getMessagePopover(b);this.getView().rerender();E.fireEvent("press");}},errorCreateFOD:function(e){},onNavToContract:function(e){var s=e.getSource().getBindingContext();this.vFailedGuid=this.getView().getModel().getProperty('PurchaseContractDraftUUID',s);var p=this.getView().getModel().getProperty('PurchaseContract',s);this.PurCtr=p.replace(/^\D+/g,'');this.vActivePurchaseContract="%2523%2520%2520%2520%2520%2520%2520%2520"+this.PurCtr;var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");c.toExternal({target:{semanticObject:"PurchaseContract",action:"manage"},params:{DraftUUID:this.vFailedGuid,PurchaseContract:decodeURIComponent(decodeURIComponent(this.vActivePurchaseContract)),IsActiveEntity:"false"}});},getGuid:function(s){return s.slice(0,8)+"-"+s.slice(8,12)+"-"+s.slice(12,16)+"-"+s.slice(16,20)+"-"+s.slice(20,s.length+1);},_getMessagePopover:function(b){var c=new J();c.setData(b);var v=new J();v.setData({messagesLength:b.length+''});this.byId('idBCtrMsgPopover').setModel(v);return o.setModel(c);},handleMessagePopoverPress:function(e){o.openBy(e.getSource());},_getMessageState:function(s){switch(s){case'error':return sap.ui.core.ValueState.Error;break;case'warning':return sap.ui.core.ValueState.Warning;break;case'success':return sap.ui.core.ValueState.Success;break;case'info':return sap.ui.core.ValueState.Success;break;}},_getMessageIcon:function(s){switch(s){case'error':return"sap-icon://error";break;case'warning':return"sap-icon://notification";break;case'success':return"sap-icon://sys-enter";break;case'info':return"sap-icon://sys-enter";break;}},_getMessagePopup:function(b){var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");var d={"messages":b};var t=new sap.m.Table({growing:true,inset:false,fixedLayout:false,backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:"Inner",columns:[new sap.m.Column({width:"25rem",styleClass:"name",hAlign:"Left",vAlign:"Top",})]});var g=new sap.m.ColumnListItem({unread:false,vAlign:"Top",cells:[new sap.ui.layout.Grid({vSpacing:0,hSpacing:1,content:[new sap.m.ObjectStatus({icon:"{icon}",state:"{state}",layoutData:new sap.ui.layout.GridData({span:"L2 M2 S2"})}),new sap.m.Text({text:"{name}",layoutData:new sap.ui.layout.GridData({span:"L10 M10 S10"})})]})]});this.vNumberofMessages=d.messages.length;var h=new sap.ui.model.json.JSONModel();h.setData(d);t.setModel(h);t.bindAggregation("items","/messages",g);this.oMessageDialog=new sap.m.Dialog({content:[t,],buttons:[new sap.m.Button({text:"{i18n>ManagePurchaseContracts}",tap:jQuery.proxy(function(e){c.toExternal({target:{semanticObject:"PurchaseContract",action:"manage"},params:{DraftUUID:this.vFailedGuid,PurchaseContract:this.vActivePurchaseContract,IsActiveEntity:"false"}});this.oMessageDialog.close();},this)}),new sap.m.Button({text:"{i18n>Close}",tap:jQuery.proxy(function(e){this.oMessageDialog.close();this.refreshContractDrafts();},this)})],state:"None",contentWidth:"25rem"});this.oMessageDialog.setTitle("{i18n>MSG}"+' ('+this.vNumberofMessages+')');this.getView().addDependent(this.oMessageDialog);this.oMessageDialog.addStyleClass("sapUiSizeCompact");return this.oMessageDialog;},handleNavToPRFactsheet:function(e){var s=e.getSource().getBindingContext().getObject().PurchaseRequisition;var v=e.getSource().getBindingContext().getObject().PurchaseRequisitionItem;var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");c.toExternal({target:{semanticObject:"PurchaseRequisition",action:"maintain"},params:{PurchaseRequisition:s,PurchaseRequisitionItem:v}});},handleNavToFactSheet:function(e){var s=e.getSource().getBindingContext().getObject().Material;var c=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("CrossApplicationNavigation");c.toExternal({target:{semanticObject:"Material",action:"displayFactSheet"},params:{Material:s}});}});});
